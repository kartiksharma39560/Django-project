{% extends 'home/base.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="{% static 'style.css' %}" rel="stylesheet" />
    <style>
                   
  .cart-icon {
    width: 40px;
    height: 40px;
    background-color: white;
    border-radius: 50%;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
 
  }

  .cart-icon i {
    font-size: 20px;
    color:black;
  }

  .badge {
    position: absolute;
    top: 0;
    right: 0;
    background-color: #e74c3c;
    color: #fff;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
  } 
    </style>
</head>
{% block body %}

<nav class="navbar navbar-expand-lg navbar-light bg-light ">
  <a class="navbar-brand" href="#">My Awesome Cart</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Dropdown
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="#">Action</a>
          <a class="dropdown-item" href="#">Another action</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Something else here</a>
        </div>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
      </li>
    </ul>

    <div id="cartContainer" class="d-flex justify-content-center align-items-center   ">
      <button class="btn btn-outline-dark"   id="popcart" data-toggle="popover">
        <i class="bi-cart-fill me-1"></i>
        Cart
        <span class="badge bg-dark text-white ms-1 rounded-pill" id="cart">0</span>
      </button>
    </div>
  </nav>
     
     
<!-- 
<form class="d-flex" id="cartContainer">
  <button class="btn btn-outline-dark"   id="popcart" data-toggle="popover">
    <i class="bi-cart-fill me-1"></i>
    Cart 
    <span class="badge bg-dark text-white ms-1 rounded-pill" id="cart">0</span>
  </button>
</form> -->
 


<div class="container d-flex justify-content-center align-items-center flex-wrap">
    <div class="card mt-5 mx-5" style="width: 18rem;">
        <a href="{% url 'productview' myid=1 %}" class="text-decoration-none text-black">
            <img class="card-img-top" src="/media/{{product.0.image}}" alt="Card image cap" />
            <div class="card-body">
                <h5 class="card-title">{{product.0.product_name}}</h5>
                <p class="card-text">{{product.0.desc}}</p>
            </a>
            <button id="pr{{product.0.id}}" class="btn btn-primary cart">Add to Cart</button>
        </div>
    </div>
    
    <!-- {% for i in product|slice:"1:" %}
    ... (Code for additional products)
    {% endfor %} -->

    {% for i in product|slice:"1:" %}
    <div class="col-xs-3 col-sm-3 col-md-3 mt-5 mx-4">
        <div class="card" style="width: 18rem;">
            <a href="{% url 'productview' myid=i.id %}" >class="text-decoration-none text-black">
                <img src="/media/{{i.image}}" class="card-img-top" alt="..." />
                <div class="card-body">
                    <h5 class="card-title" id="name{{i.id}}">{{i.product_name}}</h5>
                    <p class="card-text" id="desc{{i.id}}">{{i.desc}}</p>
                </div>
            </a>
            <button id="pr{{i.id}}" class="btn btn-primary cart">Add to Cart</button>
        </div>
    </div>
    {% endfor %}
</div>





<script>
document.addEventListener("DOMContentLoaded", function(event) {
    console.log("working");
    var cart = {};
    
    // Find the cart in local storage
    if (localStorage.getItem("cart")) {
        cart = JSON.parse(localStorage.getItem("cart"));
        updateCartDisplay();
    }

    // Add to cart button click event
    $(".cart").click(function () {
        var idstr = this.id.toString();
        console.log(idstr);

        if (cart[idstr] !== undefined) {
            cart[idstr] = cart[idstr] + 1;
        } else {
            cart[idstr] = 1;
        }

        console.log(cart);
        localStorage.setItem("cart", JSON.stringify(cart));
        updateCartDisplay();
    });

    function updateCartDisplay() {
        var cartCount = Object.keys(cart).length;
        document.getElementById("cart").innerHTML = cartCount;
    }

    $("#empty-cart").click(function () {
        cart = {}; // Clear the cart object
        localStorage.removeItem("cart"); // Remove the cart from localStorage
        updateCartDisplay(); // Update the cart display
    });

    // Initialize popover
$('[data-toggle="popover"]').popover({
    html: true,
    content: function () {
        return cartContent();
    }
});

// Handle the Clear Cart button click event
$(document).on('click', '#clearCart', function() {
    cart = {}; // Clear the cart object
    localStorage.removeItem("cart"); // Remove the cart from localStorage
    updateCartDisplay(); // Update the cart display
    $('#popcart').popover('hide'); // Close the popover
});

// Function to generate cart content for the popover
function cartContent() {
    var popStr = "<h5>Cart for your items in my shopping cart</h5><button>Checkout</button><div class='mx-2 my-2'> ";
    var i = 1;
    for (var item in cart) {
        var itemWithoutPrefix = item.substring(2); // Remove the "pr" prefix
        popStr += `<b>${i}</b>. ${document.getElementById('name' + itemWithoutPrefix).textContent}, Qty: ${cart[item]}<br>`;
        i++;
    }
    popStr += '<button class="btn btn-danger" id="clearCart">Clear Cart</button>';
    popStr += "  </div>";
    return popStr;
}


  
  
  
});


</script>
<script language="JavaScript" type="text/javascript" src="/js/jquery-1.2.6.min.js"></script>
<script language="JavaScript" type="text/javascript" src="/js/jquery-ui-personalized-1.5.2.packed.js"></script>
<script language="JavaScript" type="text/javascript" src="/js/sprinkle.js"></script>
{% endblock %}
</html>
